package pages;


import base.BasePage;
import org.openqa.selenium.By;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.JavascriptExecutor;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;


import java.time.Duration;


public class CartPage extends BasePage {


private final By checkoutButton = By.id("checkout");


public CartPage(WebDriver driver) {
super(driver);
}


public CheckoutInfoPage clickCheckout() {
// handle any popup that might block interaction
handlePasswordPopupIfPresent();


WebElement checkoutBtn = driver.findElement(checkoutButton);


// scroll into view and click via JS to avoid issues
((JavascriptExecutor) driver).executeScript("arguments[0].scrollIntoView(true);", checkoutBtn);
try { Thread.sleep(300); } catch (InterruptedException ignored) {}


((JavascriptExecutor) driver).executeScript("arguments[0].click();", checkoutBtn);


// handle popup again if it appears after clicking
handlePasswordPopupIfPresent();


// wait for checkout page or first-name element
WebDriverWait wait = new WebDriverWait(driver, Duration.ofSeconds(10));
wait.until(ExpectedConditions.or(
ExpectedConditions.urlContains("checkout-step-one"),
ExpectedConditions.visibilityOfElementLocated(By.id("first-name"))
));


return new CheckoutInfoPage(driver);
}
}